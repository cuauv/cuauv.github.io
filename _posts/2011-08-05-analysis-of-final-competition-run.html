---
layout: post
title: Analysis of Final Competition Run
submitter: prlead
date: 2011-08-05 17:36:27
old_id: 167
---

It was mentioned in the last post that the vehicle suffered from a race condition in the mission code and that caused it to not perform as well as it did in its qualifying runs. This post will go more into depth as to exactly what went wrong and how the problems will be fixed in the future, for those who are interested. As a preface to this analysis, it should be made clear that the members at the dock during the run made all the correct decisions given the information that they had, and without their quick thinking the team would not have been able to salvage a very competitive run from this bug.

    The first attempt at the full mission was where the race condition came into play. The software team on the dock thought that either the vehicle did not get within camera range of the yellow buoy (since their elevations were changed about 5 minutes before the run) or that the poor lighting conditions prevented vision from working on the yellow buoy. Post-run, it was found in the logs that the backup-and-sway task started (this task is responsible for making the vehicle back up after the ram and sway to find the next buoy), but the generic-find did not run (this task actually looks for the buoy). When it was run on our recording, the vision software seemed to work well enough, suggesting that it wasnt the problem. Upon comparing the debug logs to a successful run, one of the team members, Jeff, noticed that the order of execution between these two tasks was swapped in the failed mission. This suggests a possible race condition (i.e. the correct execution of these tasks was dependent on them being added or initialized in a specific order). One mystery that remains is that both tasks should have still run because they were both non-blocking (meaning neither will prevent the execution of other tasks in parallel). This will be investigated in the coming weeks.

    The second run went wrong due to human error. Unfortunately, the team on the dock incorrectly thought they had shut down the old mission and started a new one. This meant the two missions ran in parallel and fought for control of the sub, making the vehicle miss the validation gate completely. This type of error is somewhat unavoidable, but will be mitigated next year by having even more practice time that simulates the competition. The software team during the summer will practice having the vehicle pulled back and reprogramming on dock as if a run went wrong.

    Once the second mission had been stopped, the vehicle started its third run. This was much more successful. Unfortunately, the mission had been changed to only hit the green buoy twice but the direction to search after the buoys had not been changed. This meant the vehicle did not find the correct pipe to get to the next competition element. Despite this, the vehicle timed out and completed the rest of the mission with only a few seconds remaining, getting us enough points for second place.

    A few things will be done this year to fix these problems. First, the team will push even harder to get into the water on time to give the software team more time to do full autonomous testing. This amounts to more competition-like practice for the people driving the vehicle, and this will allow them to experience issues that come up when running untethered and hopefully better prepare them for competition runs. Also, our mission system is currently too complex. It makes the timeline of adding and initializing simultaneous tasks at best confusing and at worst non-deterministic. This year the system will be largely reworked. It is currently multi-threaded, but one idea is to rework it into a single-threaded program which will interleave the running of the mission tasks like multi-threading would while retaining determinism. It will be reworked so the mission tasks themselves do not have to be altered; the only ones that will change are those that depend on the quirks of the current system. There are also plans to make a mission replay system which will help replicate rare bugs. The entire mission will be recorded (including vision, sensor values, and other variables) and then used as an input to the mission code to see exactly what went wrong. Since race conditions are random, it will not recreate them reliably, but if an error doesnt occur during playback it would point to a random race-type condition.
  